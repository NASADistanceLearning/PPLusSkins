if(!window.Accordent){window.Accordent={}}Accordent.TrackSettings=function(){return{config:{},query:new Accordent.QueryString(window.location.search),endPresentation:function(){try{top.window.close()}catch(a){}},requiresAmms:function(){return"<<@IsAmms@>>".toLowerCase() in {yes:"","true":"",1:"",enabled:""}},redirectToSelf:function(c){try{var a=window.location.href.split("?");if(a.length>=2){var d=new Accordent.QueryString(a[1]);if(!isNullOrBlank(c)){d.append(c)}window.location="{0}{1}".format(a[0],d.toString())}}catch(b){}},redirectToMessage:function(a,b){window.location="message.htm?code={0}&type={1}".format(a,b)}}}();Accordent.TrackSettings.playerType=function(){var a=Accordent.TrackSettings.query.player||PlayerType.Unknown;if(window.getTrackingType&&typeof(window.getTrackingType)=="function"){a=getTrackingType()}if(a==PlayerType.Real){if(!window.playStateChangeReal){playStateChangeReal=function(b){if(window.Accordent&&Accordent.Tracking&&Accordent.Tracking.onRnStateChange){Accordent.Tracking.onRnStateChange(b)}}}if(!window.onPositionChange){onPositionChange=function(c,b){if(window.Accordent&&Accordent.Tracking&&Accordent.Tracking.onRnPositionChange){Accordent.Tracking.onRnPositionChange(c,b)}}}}else{if(a==PlayerType.Wmp||a==PlayerType.Silverlight||a==PlayerType.AllSilverlight){if(!window.playStateChange){playStateChange=function(b){if(window.Accordent&&Accordent.Tracking&&Accordent.Tracking.onMsPlayStateChanged){Accordent.Tracking.onMsPlayStateChanged(b)}}}if(a==PlayerType.Wmp&&!document.getElementById("PlayStateChange")){window.document.write('<script id="PlayStateChange" type="text/javascript" for="MediaPlayer" event="PlayStateChange(NewState)">playStateChange(NewState);</script>')}}else{if(a==PlayerType.Flash){if(!window.flashPlayStateChange){flashPlayStateChange=function(b,c){if(window.Accordent&&Accordent.Tracking&&Accordent.Tracking.onFlashStateChange){Accordent.Tracking.onFlashStateChange(b,c)}}}}}}return a}();Accordent.TrackBaseLevel=Class.extend({init:function(){var a=Accordent.TrackSettings.query;var b=(a.ammsurl||"").split("?");b=trim(decodeUrl(b[0],["/"]));if(!isNullOrBlank(b)){var c=b.lastIndexOf("/");this._tid=parseInt(b.substr(c+1))||0;this._ammsRootUrl=decodeUrl(b.slice(0,c<0?b.length:c+1))}this._requiresAmms=Accordent.TrackSettings.requiresAmms()},getConfig:function(){var a=Accordent.TrackSettings.query;return{tid:this._tid||0,interval:parseInt(a.trackinginterval)||6,tt:a.tt,time:toSeconds(a.time),uid:a.u,pid:a.i,tu:"{0}trackingPostback.aspx".format(this._ammsRootUrl),ammsUrl:this._ammsRootUrl,mu:decodeUrl(isNullOrBlank(this._ammsRootUrl)?a.mediaurl:"{0}{1}/playlist.ashx".format(this._ammsRootUrl,this._tid)),qau:"{0}{1}/postQuestion.ashx".format(this._ammsRootUrl,this._tid)}},canRun:function(){return !this._requiresAmms||!isNullOrBlank(this._ammsRootUrl)},ensureMediaUrl:function(){if(!this.canRun()){Accordent.TrackSettings.endPresentation();Accordent.TrackSettings.redirectToMessage(Messages.AmmsNotFound.code,MessageTypes.Error.code);return}var a=this.getConfig().mu||"";var b=decodeUrl(Accordent.TrackSettings.query.mediaurl)||"";if(a.toLowerCase()!=b.toLowerCase()){Accordent.TrackSettings.redirectToSelf("mediaUrl="+a);return}},getServerTrackingJsUrl:function(){return"{0}trackingReference.aspx?version=3".format(this._ammsRootUrl)},run:function(){if(!isNullOrBlank(this._ammsRootUrl)){(new JSONscriptRequest()).addScript(this.getServerTrackingJsUrl(),false)}}});function getTrackingStrategy(){return new Accordent.TrackBaseLevel()}function loadTrackingConfig(a){try{var b=getTrackingStrategy();if(!b){return}Accordent.TrackSettings.config=a||b.getConfig();b.run()}catch(c){}}function beginTracking(){var a=getTrackingStrategy();a.ensureMediaUrl();if(a._tid>0&&!isNullOrBlank(a._ammsRootUrl)&&a.canRun()){if(a.getServerInfoJsUrl){(new JSONscriptRequest()).addScript(a.getServerInfoJsUrl())}else{loadTrackingConfig(null)}if(top.setModQaMode){top.setModQaMode(QaMode.Question)}}}beginTracking();